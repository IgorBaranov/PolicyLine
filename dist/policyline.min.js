module.exports=function(t){function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}var e={};return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},r.p="",r(r.s=2)}([function(t,r,e){"use strict";function n(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}function o(t){return t instanceof Date?t:new Date(t)}function u(t,r,e){var o;f[t]=(o={},n(o,i,r),n(o,l,e),o)}function a(t){delete f[t]}Object.defineProperty(r,"__esModule",{value:!0});var i=Symbol(),l=Symbol(),f={radius:n({},l,function(t,r,e){return t.leftIsData?r.radius=t.leftValue:r.radius=t.rightValue,!0}),inArea:n({},l,function(t,r,e){function n(t){return t*(Math.PI/180)}var o=function(t,r,e,o){var u=n(e-t),a=n(o-r),i=Math.sin(u/2)*Math.sin(u/2)+Math.cos(n(t))*Math.cos(n(e))*Math.sin(a/2)*Math.sin(a/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371}(t.rightValue[0],t.rightValue[1],t.leftValue[0],t.leftValue[1]);return r.radius>=o}),or:n({},l,function(t,r,e){if(r.container=r.container||{},r.container[e]=t.result,t.result)for(var n in r.container)r.container[n]=!0;return r.container}),toInt:function(t){return parseInt(t,10)},toString:function(t){return t+""},trim:function(t){return t.trim()},uppercase:function(t){return t.toUpperCase()},lowercase:function(t){return t.toLowerCase()},minute:function(t){return o(t).getMinutes()},day:function(t){return o(t).getDate()},hour:function(t){return o(t).getHours()},weekday:function(t){return o(t).getDay()},month:function(t){return o(t).getMonth()},year:function(t){return o(t).getFullYear()}},c={prefix:i,postfix:l,register:u,unregister:a,get list(){return f}};r.default=c},function(t,r,e){"use strict";function n(t,r){var e=r.split("."),n=t,o=!0,u=!1,a=void 0;try{for(var i,l=e[Symbol.iterator]();!(o=(i=l.next()).done);o=!0){var f=i.value;try{n=n[f]}catch(t){n=null;break}}}catch(t){u=!0,a=t}finally{try{!o&&l.return&&l.return()}finally{if(u)throw a}}return n}function o(t,r,e){var o=void 0,u=void 0,i=r.value;r.isDIObj&&(i=n(t,i));var l=!0,f=!1,c=void 0;try{for(var s,v=r.mutators[Symbol.iterator]();!(l=(s=v.next()).done);l=!0){var d=s.value;r.isDIObj&&(e[r.value]=e[r.value]||{},o=e[r.value]),u=a.default.list[d],u&&"function"!=typeof u&&(u=u[a.default.prefix]),i=u?u(i,o):i}}catch(t){f=!0,c=t}finally{try{!l&&v.return&&v.return()}finally{if(f)throw c}}return i}Object.defineProperty(r,"__esModule",{value:!0}),r.extract=void 0;var u=e(0),a=function(t){return t&&t.__esModule?t:{default:t}}(u);r.extract=o},function(t,r,e){"use strict";function n(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function o(t,r){return t.isDIObj&&t.value.indexOf&&0===t.value.indexOf(r)}Object.defineProperty(r,"__esModule",{value:!0}),r.Adapter=r.Mutator=r.Operator=r.Policy=void 0;var u=function(){function t(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(r,e,n){return e&&t(r.prototype,e),n&&t(r,n),r}}(),a=e(3),i=e(5),l=Symbol(),f="user.",c="resource.",s=function(){function t(r){n(this,t);var e=void 0,u=[],i=a.Operator.list;this[l]={effect:"deny"!==r.effect,target:[],condition:[],watcher:[],lastData:null};var s=!0,v=!1,d=void 0;try{for(var p,y=r.target[Symbol.iterator]();!(s=(p=y.next()).done);s=!0){var h=p.value;u.push((0,a.parseExp)(h))}}catch(t){v=!0,d=t}finally{try{!s&&y.return&&y.return()}finally{if(v)throw d}}var b=!0,g=!1,m=void 0;try{for(var x,O=u[Symbol.iterator]();!(b=(x=O.next()).done);b=!0){var j=x.value;o(j.left,c)?this[l].condition.push(j):o(j.right,c)?(e=j.right,j.right=j.left,j.left=e,i[j.operator].reverse&&(j.operator=i[j.operator].reverse),this[l].condition.push(j)):this[l].target.push(j),o(j.left,f)||o(j.right,f)}}catch(t){g=!0,m=t}finally{try{!b&&O.return&&O.return()}finally{if(g)throw m}}}return u(t,[{key:"check",value:function(t){var r={},e={},n=void 0,o=void 0;this[l].lastData=t;var u=!0,i=!1,f=void 0;try{for(var c,s=this[l].target[Symbol.iterator]();!(u=(c=s.next()).done);u=!0){var v=c.value;n=Math.floor(65536*(1+Math.random())).toString(16).substring(1),o=(0,a.executeExp)(t,v,r,n),"boolean"==typeof o?e[n]=o:Object.assign(e,o)}}catch(t){i=!0,f=t}finally{try{!u&&s.return&&s.return()}finally{if(i)throw f}}var d=!0;return Object.values(e).forEach(function(t){d=d&&t}),this[l].effect?d:!d}},{key:"getConditions",value:function(t){"function"!=typeof t&&(t=i.Adapter.MongoJSONb);var r={},e=[],n=this[l].lastData,o=!0,u=!1,a=void 0;try{for(var f,c=this[l].condition[Symbol.iterator]();!(o=(f=c.next()).done);o=!0){var s=f.value;e.push((0,i.prepareCondition)(n,s,r))}}catch(t){u=!0,a=t}finally{try{!o&&c.return&&c.return()}finally{if(u)throw a}}return t(e)}}]),t}();r.Policy=s,r.Operator=a.Operator,r.Mutator=a.Mutator,r.Adapter=i.Adapter},function(t,r,e){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function o(t){var r="Semantic Error in "+t+": \n    Expression should be obj.attr[..mutator](operator)value or object.attribute\n    (user.role~=['admin','user'] , resource.location..radius=100)";throw new Error(r)}function u(t){return t.includes(".")&&(0===t.indexOf("user.")||0===t.indexOf("env.")||0===t.indexOf("action.")||0===t.indexOf("resource."))}function a(t){return t[0]===m&&t[t.length-1]===m&&(t='"'+t.substr(1,t.length-2)+'"'),t}function i(t){var r=t.split(".."),e=r.slice(1,r.length),n=u(r[0]),o=void 0;try{o=n?r[0]:JSON.parse(a(r[0]))}catch(t){var i="Parsing Error: \n\t unknown object - "+r[0]+" in expression";throw new Error(i)}return{isDIObj:n,value:o,mutators:e}}function l(t){var r=d.default.list,e=void 0,n=void 0;for(e in r)if(n=t.split(e),2===n.length)break;return 2===n.length&&b.test(n[0])&&g.test(n[1])||o(t),{origin:t,left:i(n[0]),operator:e,right:i(n[1])}}function f(t,r,e,n){t.mutators.forEach(function(o){var u=y.default.list[o];t.isDIObj&&"object"===(void 0===u?"undefined":s(u))&&u[y.default.postfix]&&(r.result=u[y.default.postfix](r,e[t.value],n))})}function c(t,r,e,n){var o=d.default.list,u=(0,h.extract)(t,r.left,e),a=(0,h.extract)(t,r.right,e),i="*";r.left.isDIObj&&"function"==typeof o[r.operator][r.left.value]?i=r.left.value:r.right.isDIObj&&"function"==typeof o[r.operator][r.right.value]&&(i=r.right.value);var l=o[r.operator][i](u,a),c={leftIsData:!r.left.isDIObj,rightIsData:!r.right.isDIObj,leftValue:u,rightValue:a,result:l};return f(r.left,c,e,n),f(r.right,c,e,n),c.result}Object.defineProperty(r,"__esModule",{value:!0}),r.Mutator=r.Operator=r.executeExp=r.parseExp=void 0;var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v=e(4),d=n(v),p=e(0),y=n(p),h=e(1),b=/^[a-zA-Z]+\.[a-zA-Z]+(?:\.\.[a-zA-Z]+)*/,g=/[^\n]+/,m="'";r.parseExp=l,r.executeExp=c,r.Operator=d.default,r.Mutator=y.default},function(t,r,e){"use strict";function n(t){var r=t.name,e=t.namespace,n=t.implement,o=t.reverse;u[r]=u[r]||{},u[r][e]=n,"*"===e&&o&&(u[r][e].reverse=o);var a={};Object.entries(u).sort(function(t,r){return t[0].length<r[0].length?1:t[0].length>r[0].length?-1:0}).forEach(function(t){a[t[0]]=t[1]}),u=a}function o(t){var r=t.name,e=t.namespace,n=u[r];delete n[e],0===Object.keys(n).length&&delete u[r]}Object.defineProperty(r,"__esModule",{value:!0});var u={"==":{"*":function(t,r){return t===r}},"!=":{"*":function(t,r){return t!==r}},">=":{"*":function(t,r){return t>=r},reverse:"<="},"<=":{"*":function(t,r){return t<=r},reverse:">="},"~=":{"*":function(t,r){return!!Array.isArray(r)&&r.includes(t)},reverse:"~!"},"~!":{"*":function(t,r){return!!Array.isArray(t)&&t.includes(r)},reverse:"~="},"^=":{"*":function(t,r){return!!Array.isArray(r)&&!r.includes(t)},reverse:"^!"},"^!":{"*":function(t,r){return!!Array.isArray(t)&&!t.includes(r)},reverse:"^="},"?=":{"*":function(t,r){return!t||t===r},reverse:"?!"},"?!":{"*":function(t,r){return!r||r===t},reverse:"?="},"=":{"*":function(t,r){return t===r}},">":{"*":function(t,r){return t>r},reverse:"<"},"<":{"*":function(t,r){return t<r},reverse:">"}},a={register:n,unregister:o,get list(){return u}};r.default=a},function(t,r,e){"use strict";function n(t,r,e){var n=(0,o.extract)(t,r.left,e,null),u=(0,o.extract)(t,r.right,e,null);return{resource:null===n?r.left.value:n,value:null===u?r.right.value:u,operator:r.operator,mutators:r.left.mutators}}Object.defineProperty(r,"__esModule",{value:!0}),r.prepareCondition=r.Adapter=void 0;var o=e(1),u={MongoJSONb:function(t){var r={},e=void 0,n=!0,o=!1,u=void 0;try{for(var a,i=t[Symbol.iterator]();!(n=(a=i.next()).done);n=!0){e=a.value.resource.replace("resource.",""),r[e]&&Array.isArray(r[e])}}catch(t){o=!0,u=t}finally{try{!n&&i.return&&i.return()}finally{if(o)throw u}}return t}};r.Adapter=u,r.prepareCondition=n}]);