module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=11)}([function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.namespace=t.DI=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(n(9));var o="PolicyLine_DI",i={register:function(t,n){e[o]=e[o]||{},"function"==typeof t?e[o][t.name]=t:e[o][t]=n},unregister:function(t){void 0!==e[o]&&delete e[o]["function"==typeof t?t.name:t]},clear:function(){delete e[o]},loadPresets:function(){for(var e in r.default)for(var t in r.default[e])i.register(t,r.default[e][t])}};t.DI=i,t.namespace=o}).call(this,n(1))},function(e,t,n){"use strict";var r,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"===("undefined"==typeof window?"undefined":o(window))&&(r=window)}e.exports=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e){return e&&"object"===(void 0===e?"undefined":r(e))&&!Array.isArray(e)&&!(e instanceof RegExp)}t.mergeDeep=function e(t,n){if(o(t)&&o(n))for(var r in n)o(n[r])?(t[r]||(t[r]={}),e(t[r],n[r])):t[r]=n[r];return t||n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=["AND","OR","(",")"],o={op:"OP",val:"VAL"};function i(e){return{val:e,type:r.includes(e)?o.op:o.val}}t.createTokens=function(e){return e.split(/\s+|(?=\(|\))|\b/).map(i)},t.infixToRPN=function(e){for(var t=[],n=[],r={"(":10,AND:30,OR:20};e.length;){var i=e.shift(),u=r[i.val]||0,a=n.length?r[n[n.length-1].val]:0;if(i.type===o.op&&")"===i.val)for(var s=null;"("!==(s=n.pop()).val;)t.push(s);else if(i.type===o.val)t.push(i);else if(i.type===o.op&&(!n.length||"("===i.val||u>a))n.push(i);else{for(;u<=a;)t.push(n.pop()),a=n.length?r[n[n.length-1].val]:0;n.push(i)}}for(;n.length;)t.push(n.pop());return t},t.fillTokens=function(e,t){return e.map(function(e){return e.type===o.val&&(e.res=t[e.val],e.val=[e.val]),e})},t.evaluateRPN=function(e){for(var t=[],n=void 0;e.length;){var r=e.shift();if(r.type!==o.val){var i=t.pop(),u=t.pop();switch(r.val){case"AND":t.push({type:o.val,val:i.res&&u.res?u.val.concat(i.val):[],res:i.res&&u.res});break;case"OR":n=[],u.res?n=u.val:i.res&&(n=i.val),t.push({type:o.val,val:n,res:i.res||u.res})}}else t.push(r)}return t.pop()},t.wrapToToken=i},function(e,t,n){"use strict";function r(e){var t=/([\w\.\'\"\$]+)\s?([<>=!]{1,2})\s?(.+)/.exec(e).slice(1,4);return t[0]=t[0].replace("resource.",""),t}function o(e){return new Function("user","action","env","resource","return "+e+";")}function i(e,t,n){var r=e.substring(0,e.indexOf(".")),o=e.substring(e.indexOf(".")+1);return 0!==e.indexOf("'")&&0!==e.indexOf('"')||(r="",o=e.replace(/[\'\"]/g,"")),o&&o.includes(".")&&r.length?(t[r]||(t[r]={}),i(o,t[r],n)):r.length?(t[r]||(t[r]={}),t[r][o]=n):t[o]=n,t}Object.defineProperty(t,"__esModule",{value:!0}),t.prepareCondition=function(e){var t={},n=!0,u=!1,a=void 0;try{for(var s,c=e[Symbol.iterator]();!(n=(s=c.next()).done);n=!0){var l=void 0,f=r(s.value);l="="===f[1]||"=="===f[1]?o(f[2]):[f[1],o(f[2])],void 0===t[f[0]]?t[f[0]]=l:(Array.isArray(t[f[0]])||(t[f[0]]=[t[f[0]]],t[f[0]].flag=!0),t[f[0]].push(l))}}catch(e){u=!0,a=e}finally{try{!n&&c.return&&c.return()}finally{if(u)throw a}}return function(e){for(var t in e)t.includes(".")&&(i(t,e,e[t]),delete e[t]);return e}(t)},t.calculateCondition=function e(t,n,r){for(var o in n)if(Array.isArray(n[o])&&!n[o].flag)t[o]=[n[o][0]],t[o].push(n[o][1](r.user,r.action,r.env,r.resource));else if("function"==typeof n[o])t[o]=n[o](r.user,r.action,r.env,r.resource);else if(Array.isArray(n[o])){t[o]=[];var i=void 0,u=!0,a=!1,s=void 0;try{for(var c,l=n[o][Symbol.iterator]();!(u=(c=l.next()).done);u=!0)null!==(i=(0,c.value)(r.user,r.action,r.env,r.resource))&&void 0!==i&&t[o].push(i)}catch(e){a=!0,s=e}finally{try{!u&&l.return&&l.return()}finally{if(a)throw s}}}else t[o]={},e(t[o],n[o],r);return t}},function(e,t){e.exports=require("moment")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(n(5));t.default={$timeBetween:function(e,t,n){var o=(0,r.default)(e,"HH:mm a"),i=(0,r.default)(t,"HH:mm a"),u=(0,r.default)(n,"HH:mm a");return(i.hour()>=12&&u.hour()<=12||u.isBefore(i))&&(u.add(1,"days"),o.hour()<=12&&o.add(1,"days")),o.isBetween(i,u)},$moment:function(e,t){return"unix"===t?r.default.unix(e):(0,r.default)(e,t)},$day:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"month",n=r.default.unix(e);switch(t){case"week":n=n.day();break;default:n=n.date()}return n},$week:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"month",n=r.default.unix(e);return n="year"===t?n.week():Math.ceil(n.date()/7)},$month:function(e){return r.default.unix(e).month()},$quarter:function(e){return r.default.unix(e).quarter()},$year:function(e){return r.default.unix(e).year()},$dataToTimestamp:function(e,t){return parseInt((0,r.default)(e,t).format("X"),10)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={$in:function(e,t){return e.includes(t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={$trim:function(e){return e.trim()},$uppercase:function(e){return e.toUpperCase()},$lowercase:function(e){return e.toLowerCase()},$strToInt:function(e){return parseInt(e,10)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(n(8)),o=u(n(7)),i=u(n(6));function u(e){return e&&e.__esModule?e:{default:e}}t.default={String:r.default,Array:o.default,Time:i.default}},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.settings=t.compilePolicy=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(0),i={log:!1};t.compilePolicy=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=!("any"===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all")),u=[],a="deny"===(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"deny");return t.forEach(function(t){u.push(function(t){try{var n=/([^<>=!]+)\s?([<>=!]{1,2})\s?(.+)/.exec(t);n&&("="!==(n=n.slice(1,4))[1]&&"=="!==n[1]||(n[1]="==="),t=n.join(""));var r="";if(void 0!==e[o.namespace])for(var i in e[o.namespace])t.includes(i)&&(r+="var "+i+"="+o.namespace+"."+i+";");return new Function("user","action","env","resource","var _a;"+r+"try{_a=!!("+t+");}catch(_e){_a=_e};return _a;")}catch(e){return new Function('return new Error("in access rule: '+t+'");')}}(t))}),function(e,t,o,s){var c=n,l=!0,f=!1,d=void 0;try{for(var p,v=u[Symbol.iterator]();!(l=(p=v.next()).done);l=!0){var y=(0,p.value)(e,t,o,s);if("object"===(void 0===y?"undefined":r(y)))return i.log&&console.error(y),!1;c=n?c&&y:c||y}}catch(e){f=!0,d=e}finally{try{!l&&v.return&&v.return()}finally{if(f)throw d}}return a?!c:c}},t.settings=i}).call(this,n(1))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.settings=t.DI=t.Policy=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(10),i=n(4),u=n(3),a=n(2),s=n(0);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=Symbol(),f=Symbol(),d=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),void 0!==t.policies?this._groupConstructor(t):void 0===n&&void 0===r?this._singleConstructor(t.target,t.algorithm,t.effect,t.condition):this._mergeConstructor(t,n,r),this[l]={}}return r(e,[{key:"_groupConstructor",value:function(e){for(var t in this._expression=(0,u.infixToRPN)((0,u.createTokens)(e.expression)),this._targets={},this._conditions={},e.policies){var n=e.policies[t],r=n.target,a=n.algorithm,s=n.effect,c=n.condition;this._targets[t]=(0,o.compilePolicy)(r,a,s),this._conditions[t]=(0,i.prepareCondition)(c||[])}}},{key:"_singleConstructor",value:function(e,t,n,r){var a=Math.random().toString(36).substr(2,9);this._expression=[(0,u.wrapToToken)(a)],this._targets=c({},a,(0,o.compilePolicy)(e,t,n)),this._conditions=c({},a,(0,i.prepareCondition)(r||[]))}},{key:"_mergeConstructor",value:function(e,t,n){this._expression=e._expression.concat(t._expression,(0,u.wrapToToken)(n)),this._targets=Object.assign({},e._targets,t._targets),this._conditions=Object.assign({},e._conditions,t._conditions)}}]),r(e,[{key:"check",value:function(e,t,n,r){var o={};for(var i in this._targets)o[i]=this._targets[i](e,t,n,r);return this[l]={user:e,action:t,env:n,resource:r},this[f]=(0,u.evaluateRPN)((0,u.fillTokens)(this._expression,o)),this[f].res}},{key:"condition",value:function(e,t,n,r){var o=this;if(this[f].res){var u={user:(0,a.mergeDeep)(e,this[l].user),action:(0,a.mergeDeep)(t,this[l].action),env:(0,a.mergeDeep)(n,this[l].env),resource:(0,a.mergeDeep)(r,this[l].resource)};this[l]={};try{var s={},c={};for(var d in this._conditions)try{s[d]=(0,i.calculateCondition)({},this._conditions[d],u)}catch(e){}Object.entries(s).forEach(function(e){o[f].val.includes(e[0])&&(0,a.mergeDeep)(c,e[1])}),u.condition=(0,a.mergeDeep)(c,u.resource)}catch(e){u=e}return this[f]={},u}}},{key:"and",value:function(t){return new e(this,t,"AND")}},{key:"or",value:function(t){return new e(this,t,"OR")}}]),e}();s.DI.loadPresets(),t.Policy=d,t.DI=s.DI,t.settings=o.settings}]);