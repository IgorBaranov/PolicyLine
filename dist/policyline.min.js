module.exports=function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=2)}([function(e,t,n){"use strict";var r,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"===("undefined"==typeof window?"undefined":o(window))&&(r=window)}e.exports=r},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.namespace=t.DI=void 0;var r=n(4),o=function(e){return e&&e.__esModule?e:{default:e}}(r),i={register:function(t,n){void 0===e.abac_di&&(e.abac_di={}),"function"==typeof t?e.abac_di[t.name]=t:e.abac_di[t]=n},unregister:function(t){void 0!==e.abac_di&&delete e.abac_di["function"==typeof t?t.name:t]},clear:function(){delete e.abac_di},loadPresets:function(){for(var e in o.default)for(var t in o.default[e])i.register(t,o.default[e][t])}};t.DI=i,t.namespace="abac_di"}).call(t,n(0))},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.settings=t.DI=t.Policy=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(3),a=n(9),s=n(10),c=n(11),l=n(1),f=Symbol(),d=Symbol(),p=function(){function e(t,n,r){o(this,e),void 0!==t.policies?this._groupConstructor(t):void 0===n&&void 0===r?this._singleConstructor(t.target,t.algorithm,t.effect,t.condition):this._mergeConstructor(t,n,r),this[f]={}}return i(e,[{key:"_groupConstructor",value:function(e){this._expression=(0,s.infixToRPN)((0,s.createTokens)(e.expression)),this._targets={},this._conditions={};for(var t in e.policies){var n=e.policies[t],r=n.target,o=n.algorithm,i=n.effect,c=n.condition;this._targets[t]=(0,u.compilePolicy)(r,o,i),this._conditions[t]=(0,a.prepareCondition)(c||[])}}},{key:"_singleConstructor",value:function(e,t,n,o){var i=Math.random().toString(36).substr(2,9);this._expression=[(0,s.wrapToToken)(i)],this._targets=r({},i,(0,u.compilePolicy)(e,t,n)),this._conditions=r({},i,(0,a.prepareCondition)(o||[]))}},{key:"_mergeConstructor",value:function(e,t,n){this._expression=e._expression.concat(t._expression,(0,s.wrapToToken)(n)),this._targets=Object.assign({},e._targets,t._targets),this._conditions=Object.assign({},e._conditions,t._conditions)}}]),i(e,[{key:"check",value:function(e,t,n,r){var o={};for(var i in this._targets)o[i]=this._targets[i](e,t,n,r);return this[f]={user:e,action:t,env:n,resource:r},this[d]=(0,s.evaluateRPN)((0,s.fillTokens)(this._expression,o)),this[d].res}},{key:"condition",value:function(e,t,n,r){var o=this;if(this[d].res){var i={user:(0,c.mergeDeep)(e,this[f].user),action:(0,c.mergeDeep)(t,this[f].action),env:(0,c.mergeDeep)(n,this[f].env),resource:(0,c.mergeDeep)(r,this[f].resource)};this[f]={};try{var u={},s={};for(var l in this._conditions)u[l]=(0,a.calculateCondition)({},this._conditions[l],i);Object.entries(u).forEach(function(e){o[d].val.includes(e[0])&&(0,c.mergeDeep)(s,e[1])}),i.condition=(0,c.mergeDeep)(s,i.resource)}catch(e){i=e}return this[d]={},i}}},{key:"and",value:function(t){return new e(this,t,"AND")}},{key:"or",value:function(t){return new e(this,t,"OR")}}]),e}();l.DI.loadPresets(),t.Policy=p,t.DI=l.DI,t.settings=u.settings},function(e,t,n){"use strict";(function(e){function r(t){var n=/([^<>=]+)\s?([<>=!]{1,2})\s?(.+)/;try{var r=n.exec(t);r&&(r=r.slice(1,4),"="!==r[1]&&"=="!==r[1]||(r[1]="==="),t=r.join(""));var o="";if(void 0!==e[u.namespace])for(var i in e[u.namespace])t.includes(i)&&(o+="var "+i+"="+u.namespace+"."+i+";");return new Function("user","action","env","resource","var _a;"+o+"try{_a=!!("+t+");}catch(_e){_a=_e};return _a;")}catch(e){return new Function('return new Error("in access rule: '+t+'");')}}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"deny",o=!("any"===t),u=[],s="deny"===n;return e.forEach(function(e){u.push(r(e))}),function(e,t,n,r){var c=o,l=!0,f=!1,d=void 0;try{for(var p,v=u[Symbol.iterator]();!(l=(p=v.next()).done);l=!0){var y=p.value,h=y(e,t,n,r);if("object"===(void 0===h?"undefined":i(h)))return a.log&&console.error(h),!1;c=o?c&&h:c||h}}catch(e){f=!0,d=e}finally{try{!l&&v.return&&v.return()}finally{if(f)throw d}}return s?!c:c}}Object.defineProperty(t,"__esModule",{value:!0}),t.settings=t.compilePolicy=void 0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=n(1),a={log:!1};t.compilePolicy=o,t.settings=a}).call(t,n(0))},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),i=r(o),u=n(6),a=r(u),s=n(7),c=r(s);t.default={String:i.default,Array:a.default,Time:c.default}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={$trim:function(e){return e.trim()},$uppercase:function(e){return e.toUpperCase()},$lowercase:function(e){return e.toLowerCase()},$strToInt:function(e){return parseInt(e,10)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={$in:function(e,t){return e.includes(t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),o=function(e){return e&&e.__esModule?e:{default:e}}(r);t.default={$timeBetween:function(e,t,n){var r=(0,o.default)(e,"HH:mm a"),i=(0,o.default)(t,"HH:mm a"),u=(0,o.default)(n,"HH:mm a");return(i.hour()>=12&&u.hour()<=12||u.isBefore(i))&&(u.add(1,"days"),r.hour()<=12&&r.add(1,"days")),r.isBetween(i,u)},$moment:function(e,t){return"unix"===t?o.default.unix(e):(0,o.default)(e,t)},$day:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"month",n=o.default.unix(e);switch(t){case"week":n=n.day();break;default:n=n.date()}return n},$week:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"month",n=o.default.unix(e);return n="year"===t?n.week():Math.ceil(n.date()/7)},$month:function(e){return o.default.unix(e).month()},$quarter:function(e){return o.default.unix(e).quarter()},$year:function(e){return o.default.unix(e).year()},$dataToTimestamp:function(e,t){return parseInt((0,o.default)(e,t).format("X"),10)}}},function(e,t){e.exports=require("moment")},function(e,t,n){"use strict";function r(e){var t=/([\w\.\'\"\$]+)\s?([<>=!]{1,2})\s?(.+)/,n=t.exec(e).slice(1,4);return n[0]=n[0].replace("resource.",""),n}function o(e){return new Function("user","action","env","resource","return "+e+";")}function i(e,t,n){var r=e.substring(0,e.indexOf(".")),o=e.substring(e.indexOf(".")+1);return 0!==e.indexOf("'")&&0!==e.indexOf('"')||(r="",o=e.replace(/[\'\"]/g,"")),o&&o.includes(".")&&r.length?(t[r]||(t[r]={}),i(o,t[r],n)):r.length?(t[r]||(t[r]={}),t[r][o]=n):t[o]=n,t}function u(e){for(var t in e)t.includes(".")&&(i(t,e,e[t]),delete e[t]);return e}function a(e){var t={},n=!0,i=!1,a=void 0;try{for(var s,c=e[Symbol.iterator]();!(n=(s=c.next()).done);n=!0){var l=s.value,f=void 0,d=r(l);f="="===d[1]||"=="===d[1]?o(d[2]):[d[1],o(d[2])],void 0===t[d[0]]?t[d[0]]=f:(Array.isArray(t[d[0]])||(t[d[0]]=[t[d[0]]],t[d[0]].flag=!0),t[d[0]].push(f))}}catch(e){i=!0,a=e}finally{try{!n&&c.return&&c.return()}finally{if(i)throw a}}return u(t)}function s(e,t,n){for(var r in t)if(Array.isArray(t[r])&&!t[r].flag)e[r]=[t[r][0]],e[r].push(t[r][1](n.user,n.action,n.env,n.resource));else if("function"==typeof t[r])e[r]=t[r](n.user,n.action,n.env,n.resource);else if(Array.isArray(t[r])){e[r]=[];var o=!0,i=!1,u=void 0;try{for(var a,c=t[r][Symbol.iterator]();!(o=(a=c.next()).done);o=!0){var l=a.value;e[r].push(l(n.user,n.action,n.env,n.resource))}}catch(e){i=!0,u=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw u}}}else e[r]={},s(e[r],t[r],n);return e}Object.defineProperty(t,"__esModule",{value:!0}),t.prepareCondition=a,t.calculateCondition=s},function(e,t,n){"use strict";function r(e){return{val:e,type:s.includes(e)?c.op:c.val}}function o(e){return e.split(/\s+|(?=\(|\))|\b/).map(r)}function i(e){for(var t=[],n=[],r={"(":10,AND:30,OR:20};e.length;){var o=e.shift(),i=r[o.val]||0,u=n.length?r[n[n.length-1].val]:0;if(o.type===c.op&&")"===o.val)for(var a=null;"("!==(a=n.pop()).val;)t.push(a);else if(o.type===c.val)t.push(o);else if(o.type===c.op&&(!n.length||"("===o.val||i>u))n.push(o);else{for(;i<=u;)t.push(n.pop()),u=n.length?r[n[n.length-1].val]:0;n.push(o)}}for(;n.length;)t.push(n.pop());return t}function u(e,t){return e.map(function(e){return e.type===c.val&&(e.res=t[e.val],e.val=[e.val]),e})}function a(e){for(var t=[],n=void 0;e.length;){var r=e.shift();if(r.type!==c.val){var o=t.pop(),i=t.pop();switch(r.val){case"AND":t.push({type:c.val,val:o.res&&i.res?i.val.concat(o.val):[],res:o.res&&i.res});break;case"OR":n=[],i.res?n=i.val:o.res&&(n=o.val),t.push({type:c.val,val:n,res:o.res||i.res})}}else t.push(r)}return t.pop()}Object.defineProperty(t,"__esModule",{value:!0});var s=["AND","OR","(",")"],c={op:"OP",val:"VAL"};t.createTokens=o,t.infixToRPN=i,t.fillTokens=u,t.evaluateRPN=a,t.wrapToToken=r},function(e,t,n){"use strict";function r(e){return e&&"object"===(void 0===e?"undefined":i(e))&&!Array.isArray(e)&&!(e instanceof RegExp)}function o(e,t){if(r(e)&&r(t))for(var n in t)r(t[n])?(e[n]||(e[n]={}),o(e[n],t[n])):e[n]=t[n];return e||t}Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.mergeDeep=o}]);