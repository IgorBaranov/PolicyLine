module.exports=function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(t){var n=/([^<>=]+)\s?([<>=!]{1,2})\s?(.+)/;try{var r=n.exec(t);r&&(r=r.slice(1,4),"="!==r[1]&&"=="!==r[1]||(r[1]="==="),t=r.join(""));var o="";if(void 0!==e[b])for(var i in e[b])t.includes(i)&&(o+="var "+i+"="+b+"."+i+";");return new Function("user","action","env","resource","var _a;"+o+"try{_a=!!("+t+");}catch(_e){_a=_e};return _a;")}catch(e){return new Function('return new Error("in access rule: '+t+'");')}}function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"deny",r=!("any"===t),o=[],u="deny"===n;return e.forEach(function(e){o.push(i(e))}),function(e,t,n,i){var a=r,s=!0,c=!1,l=void 0;try{for(var f,v=o[Symbol.iterator]();!(s=(f=v.next()).done);s=!0){var d=f.value,p=d(e,t,n,i);if("object"===(void 0===p?"undefined":h(p)))return x.log&&console.error(p),!1;a=r?a&&p:a||p}}catch(e){c=!0,l=e}finally{try{!s&&v.return&&v.return()}finally{if(c)throw l}}return u?!a:a}}function a(e){var t=/([\w\.\'\"\$]+)\s?([<>=!]{1,2})\s?(.+)/,n=t.exec(e).slice(1,4);return n[0]=n[0].replace("resource.",""),n}function s(e){return new Function("user","action","env","resource","return "+e+";")}function c(e,t,n){var r=e.substring(0,e.indexOf(".")),o=e.substring(e.indexOf(".")+1);return 0!==e.indexOf("'")&&0!==e.indexOf('"')||(r="",o=e.replace(/[\'\"]/g,"")),o&&o.includes(".")&&r.length?(t[r]||(t[r]={}),c(o,t[r],n)):r.length?(t[r]||(t[r]={}),t[r][o]=n):t[o]=n,t}function l(e){for(var t in e)t.includes(".")&&(c(t,e,e[t]),delete e[t]);return e}function f(e){var t={},n=!0,r=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done);n=!0){var c=i.value,f=void 0,v=a(c);f="="===v[1]||"=="===v[1]?s(v[2]):[v[1],s(v[2])],void 0===t[v[0]]?t[v[0]]=f:(Array.isArray(t[v[0]])||(t[v[0]]=[t[v[0]]],t[v[0]].flag=!0),t[v[0]].push(f))}}catch(e){r=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(r)throw o}}return l(t)}function v(e,t,n){for(var r in t)if(Array.isArray(t[r])&&!t[r].flag)e[r]=[t[r][0]],e[r].push(t[r][1](n.user,n.action,n.env,n.resource));else if("function"==typeof t[r])e[r]=t[r](n.user,n.action,n.env,n.resource);else if(Array.isArray(t[r])){e[r]=[];var o=!0,i=!1,u=void 0;try{for(var a,s=t[r][Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var c=a.value;e[r].push(c(n.user,n.action,n.env,n.resource))}}catch(e){i=!0,u=e}finally{try{!o&&s.return&&s.return()}finally{if(i)throw u}}}else e[r]={},v(e[r],t[r],n);return e}function d(e){return e&&"object"===(void 0===e?"undefined":h(e))&&!Array.isArray(e)&&null!==e&&!(e instanceof RegExp)}function p(e,t){if(d(e)&&d(t))for(var n in t)d(t[n])?(e[n]||Object.assign(e,o({},n,{})),p(e[n],t[n])):Object.assign(e,o({},n,t[n]));return e||t}Object.defineProperty(t,"__esModule",{value:!0}),t.settings=t.DI=t.Policy=void 0;var y=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g=n(2),m=n(3),_=function(e){return e&&e.__esModule?e:{default:e}}(m),b="abac_di",x={log:!1},w={register:function(t,n){void 0===e[b]&&(e[b]={}),"function"==typeof t?e[b][t.name]=t:e[b][t]=n},unregister:function(t){void 0!==e[b]&&delete e[b]["function"==typeof t?t.name:t]},clear:function(){delete e[b]},loadPresets:function(){for(var e in _.default)for(var t in _.default[e])w.register(t,_.default[e][t])}},O=Symbol(),k=Symbol(),P=function(){function e(t,n,o){r(this,e),void 0!==t.policies?this._groupConstructor(t):void 0===n&&void 0===o?this._singleConstructor(t.target,t.algorithm,t.effect,t.condition):this._mergeConstructor(t,n,o),this[O]={}}return y(e,[{key:"_groupConstructor",value:function(e){this._expression=(0,g.infixToRPN)((0,g.createTokens)(e.expression)),this._targets={},this._conditions={};for(var t in e.policies){var n=e.policies[t],r=n.target,o=n.algorithm,i=n.effect,a=n.condition;this._targets[t]=u(r,o,i),this._conditions[t]=f(a||[])}}},{key:"_singleConstructor",value:function(e,t,n,r){var i=Math.random().toString(36).substr(2,9);this._expression=[(0,g.wrapToToken)(i)],this._targets=o({},i,u(e,t,n)),this._conditions=o({},i,f(r||[]))}},{key:"_mergeConstructor",value:function(e,t,n){this._expression=e._expression.concat(t._expression,(0,g.wrapToToken)(n)),this._targets=Object.assign({},e._targets,t._targets),this._conditions=Object.assign({},e._conditions,t._conditions)}}]),y(e,[{key:"check",value:function(e,t,n,r){var o={};for(var i in this._targets)o[i]=this._targets[i](e,t,n,r);return this[O]={user:e,action:t,env:n,resource:r},this[k]=(0,g.evaluateRPN)((0,g.fillTokens)(this._expression,o)),this[k].res}},{key:"condition",value:function(e,t,n,r){var o=this;if(this[k].res){var i={user:p(e,this[O].user),action:p(t,this[O].action),env:p(n,this[O].env),resource:p(r,this[O].resource)};this[O]={};try{var u={},a={};for(var s in this._conditions)u[s]=v({},this._conditions[s],i);Object.entries(u).forEach(function(e){o[k].val.includes(e[0])&&p(a,e[1])}),i.condition=p(a,i.resource)}catch(e){i=e}return this[k]={},i}}},{key:"and",value:function(t){return new e(this,t,"AND")}},{key:"or",value:function(t){return new e(this,t,"OR")}}]),e}();P.compilePolicy=u,P.compileRule=i,w.loadPresets(),t.Policy=P,t.DI=w,t.settings=x}).call(t,n(1))},function(e,t,n){"use strict";var r,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"===("undefined"==typeof window?"undefined":o(window))&&(r=window)}e.exports=r},function(e,t,n){"use strict";function r(e){return{val:e,type:s.includes(e)?c.op:c.val}}function o(e){return e.split(/\s+|(?=\(|\))|\b/).map(r)}function i(e){for(var t=[],n=[],r={"(":10,AND:30,OR:20};e.length;){var o=e.shift(),i=r[o.val]||0,u=n.length?r[n[n.length-1].val]:0;if(o.type===c.op&&")"===o.val)for(var a=null;"("!==(a=n.pop()).val;)t.push(a);else if(o.type===c.val)t.push(o);else if(o.type===c.op&&(!n.length||"("===o.val||i>u))n.push(o);else{for(;i<=u;)t.push(n.pop()),u=n.length?r[n[n.length-1].val]:0;n.push(o)}}for(;n.length;)t.push(n.pop());return t}function u(e,t){return e.map(function(e){return e.type===c.val&&(e.res=t[e.val],e.val=[e.val]),e})}function a(e){for(var t=[],n=void 0;e.length;){var r=e.shift();if(r.type!==c.val){var o=t.pop(),i=t.pop();switch(r.val){case"AND":t.push({type:c.val,val:o.res&&i.res?i.val.concat(o.val):[],res:o.res&&i.res});break;case"OR":n=[],i.res?n=i.val:o.res&&(n=o.val),t.push({type:c.val,val:n,res:o.res||i.res})}}else t.push(r)}return t.pop()}Object.defineProperty(t,"__esModule",{value:!0});var s=["AND","OR","(",")"],c={op:"OP",val:"VAL"};t.createTokens=o,t.infixToRPN=i,t.fillTokens=u,t.evaluateRPN=a,t.wrapToToken=r},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),i=r(o),u=n(5),a=r(u),s=n(6),c=r(s);t.default={String:i.default,Location:a.default,Time:c.default}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={$trim:function(e){return e.trim()},$uppercase:function(e){return e.toUpperCase()},$lowercase:function(e){return e.toLowerCase()},$strToInt:function(e){return parseInt(e,10)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=function(e){return e&&e.__esModule?e:{default:e}}(r);t.default={$timeBetween:function(e,t,n){var r=(0,o.default)(e,"HH:mm a"),i=(0,o.default)(t,"HH:mm a"),u=(0,o.default)(n,"HH:mm a");return(i.hour()>=12&&u.hour()<=12||u.isBefore(i))&&(u.add(1,"days"),r.hour()<=12&&r.add(1,"days")),r.isBetween(i,u)},$moment:function(e,t){return"unix"===t?o.default.unix(e):(0,o.default)(e,t)},$day:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"month",n=o.default.unix(e);switch(t){case"week":n=n.day();break;default:n=n.date()}return n},$week:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"month",n=o.default.unix(e);return n="year"===t?n.week():Math.ceil(n.date()/7)},$month:function(e){return o.default.unix(e).month()},$quarter:function(e){return o.default.unix(e).quarter()},$year:function(e){return o.default.unix(e).year()},$dataToTimestamp:function(e,t){return parseInt((0,o.default)(e,t).format("X"),10)}}},function(e,t){e.exports=require("moment")}]);