{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap f4054fdc6c57247e9293","webpack:///./src/index.js","webpack:///(webpack)/buildin/global.js"],"names":["namespace","settings","log","parseRule","rule","ruleReg","ruleArray","exec","slice","join","di","global","undefined","Object","keys","key","includes","Function","e","DI","register","name","fn","unregister","clear","createTargetPolicy","target","algorithm","effect","flag","rules","i","length","user","action","env","resource","result","ruleResult","console","error","Policy","origin","policy","_expression","_policies","uniqID","Math","random","toString","substr","assign","g","eval","window","module","exports"],"mappings":"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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"policyline\"] = factory();\n\telse\n\t\troot[\"policyline\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap f4054fdc6c57247e9293","const namespace = 'abac_di';\n\nconst settings = {\n    log: true\n};\n\nfunction parseRule(rule) {\n    let ruleReg = /([^<>=]+)\\s?([<>=!]{1,2})\\s?(.+)/;\n    try {\n        let ruleArray = ruleReg.exec(rule).slice(1, 4);\n        if (ruleArray[1] === '=' || ruleArray[1] === '==') {\n            ruleArray[1] = '==='\n        }\n        rule = ruleArray.join('');\n\n        // DI section\n        let di = '';\n        if (global[namespace] !== undefined) {\n            for (const key of Object.keys(global[namespace])) {\n                if (rule.includes(key)) {\n                    di += 'var ' + key + '=' + namespace + '.' + key + ';';\n                }\n            }\n        }\n\n        // create returning function\n        return new Function('user', 'action', 'env', 'resource',\n            'var _a;' + di + 'try{_a=!!(' + rule + ');}catch(_e){_a=_e};return _a;');\n    } catch (e) {\n        return new Function('return new Error(\"in access rule: ' + rule + '\");');\n    }\n}\n\nlet DI = {\n    register(name, fn) {\n        if (global[namespace] === undefined) {\n            global[namespace] = {};\n        }\n\n        if (typeof name === 'function') {\n            global[namespace][name.name] = name;\n        } else {\n            global[namespace][name] = fn;\n        }\n    },\n\n    unregister(name) {\n        if (global[namespace] === undefined) {\n            return;\n        }\n\n        delete global[namespace][(typeof name === 'function') ? name.name : name];\n    },\n\n    clear() {\n        delete global[namespace];\n    }\n};\n\n// todo refactoring\nfunction createTargetPolicy(target, algorithm = 'all', effect = 'deny') {\n    let flag = !(algorithm === 'any');\n    let rules = [];\n    for (let i = 0; i < target.length; i++) {\n        rules[i] = parseRule(target[i]);\n    }\n\n    return function (user, action, env, resource) {\n        let result = flag;\n\n        for (let i = 0; i < target.length; i++) {\n            let ruleResult = rules[i](user, action, env, resource);\n\n            // any case with errors to deny of whole policy\n            if (typeof ruleResult === 'object') {\n                if (settings.log) {\n                    console.error(ruleResult);\n                }\n                return false;\n            }\n\n            // using the algorithm\n            result = flag ? (result && ruleResult) : (result || ruleResult);\n        }\n\n        return (effect === \"deny\") ? !result : result;\n    }\n}\n\nclass Policy {\n    constructor(origin, policy, effect) {\n        this._expression = '';\n        this._policies = {};\n\n        // constructor part\n        if (policy === undefined && effect === undefined) {\n            let uniqID = '_' + Math.random().toString(36).substr(2, 9);\n            this._expression += 'data.' + uniqID;\n            this._policies[uniqID] = createTargetPolicy(origin.target, origin.algorithm, origin.effect);\n        } else {\n            // create new policy from existing two\n            this._expression = origin._expression + effect + policy._expression;\n            Object.assign(this._policies, origin._policies, policy._policies);\n        }\n    }\n\n    check(user, action, env, resource) {\n        let result = {};\n        for (let key of Object.keys(this._policies)) {\n            result[key] = this._policies[key](user, action, env, resource);\n        }\n\n        return (new Function('data', 'return ' + this._expression + ';'))(result);\n    }\n\n    and(policy) {\n        return new Policy(this, policy, '&&');\n    }\n\n    or(policy) {\n        return new Policy(this, policy, '||');\n    }\n}\n\n// static methods\nPolicy.createTargetPolicy = createTargetPolicy;\nPolicy.parseRule = parseRule;\n\nexport {\n    Policy,\n    DI,\n    settings\n}\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n\n// WEBPACK FOOTER //\n// (webpack)/buildin/global.js"],"sourceRoot":""}