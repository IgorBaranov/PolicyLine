{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap ce1e61843e11e2a39b26","webpack:///./src/index.js","webpack:///(webpack)/buildin/global.js","webpack:///./src/DI/index.js","webpack:///./src/DI/string.js","webpack:///./src/DI/location.js","webpack:///./src/DI/time.js"],"names":["namespace","settings","log","compileRule","rule","ruleReg","ruleArray","exec","slice","join","di","global","undefined","key","includes","Function","e","DI","register","name","fn","unregister","clear","loadPresets","fileName","fnName","compilePolicy","target","algorithm","effect","flag","rules","deny","forEach","push","user","action","env","resource","result","ruleResult","console","error","compileGroupExpression","origin","re","expr","expression","policies","RegExp","replace","Policy","_expression","_policies","uniqID","Math","random","toString","substr","source","Object","assign","_groupConstructor","_singleConstructor","_mergeConstructor","policy","g","eval","window","module","exports","String","Location","Time","$trim","str","trim","$uppercase","toUpperCase","$lowercase","toLowerCase"],"mappings":"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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"policyline\"] = factory();\n\telse\n\t\troot[\"policyline\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap ce1e61843e11e2a39b26","import files from './DI/index';\n\nconst namespace = 'abac_di';\n\nconst settings = {\n    log: true\n};\n\nfunction compileRule(rule) {\n    let ruleReg = /([^<>=]+)\\s?([<>=!]{1,2})\\s?(.+)/;\n    try {\n        let ruleArray = ruleReg.exec(rule).slice(1, 4);\n        if (ruleArray[1] === '=' || ruleArray[1] === '==') {\n            ruleArray[1] = '==='\n        }\n        rule = ruleArray.join('');\n\n        // DI section\n        let di = '';\n        if (global[namespace] !== undefined) {\n            for (const key in global[namespace]) {\n                if (rule.includes(key)) {\n                    di += 'var ' + key + '=' + namespace + '.' + key + ';';\n                }\n            }\n        }\n\n        // create returning function\n        return new Function('user', 'action', 'env', 'resource',\n            'var _a;' + di + 'try{_a=!!(' + rule + ');}catch(_e){_a=_e};return _a;');\n    } catch (e) {\n        return new Function('return new Error(\"in access rule: ' + rule + '\");');\n    }\n}\n\nlet DI = {\n    register(name, fn) {\n        if (global[namespace] === undefined) {\n            global[namespace] = {};\n        }\n\n        if (typeof name === 'function') {\n            global[namespace][name.name] = name;\n        } else {\n            global[namespace][name] = fn;\n        }\n    },\n\n    unregister(name) {\n        if (global[namespace] === undefined) {\n            return;\n        }\n\n        delete global[namespace][(typeof name === 'function') ? name.name : name];\n    },\n\n    clear() {\n        delete global[namespace];\n    },\n\n    loadPresets() {\n        for (const fileName in files) {\n            for (const fnName in files[fileName]) {\n                DI.register(fnName, files[fileName][fnName]);\n            }\n        }\n    }\n};\n\nfunction compilePolicy(target = [], algorithm = 'all', effect = 'deny') {\n    let flag = !(algorithm === 'any');\n    let rules = [];\n    let deny = effect === \"deny\";\n\n    target.forEach((rule) => {\n        rules.push(compileRule(rule));\n    });\n\n    return function (user, action, env, resource) {\n        let result = flag;\n\n        for (let rule of rules) {\n            let ruleResult = rule(user, action, env, resource);\n\n            // any case with errors to deny of whole policy\n            if (typeof ruleResult === 'object') {\n                if (settings.log) {\n                    console.error(ruleResult);\n                }\n                return false;\n            }\n\n            // using the algorithm\n            result = flag ? (result && ruleResult) : (result || ruleResult);\n        }\n\n        return deny ? !result : result;\n    }\n}\n\nfunction compileGroupExpression(origin) {\n    let re, expr = origin.expression;\n\n    for (const key in origin.policies) {\n        re = new RegExp('\\\\b' + key + '\\\\b', \"g\");\n        expr = expr.replace(re, 'data.' + key);\n    }\n\n    return expr\n        .replace(/\\bAND\\b/g, '&&')\n        .replace(/\\bOR\\b/g, '||');\n}\n\nclass Policy {\n    _groupConstructor(origin) {\n        this._expression = compileGroupExpression(origin);\n        this._policies = {};\n        for (const key in origin.policies) {\n            let {target, algorithm, effect} = origin.policies[key];\n            this._policies[key] = compilePolicy(target, algorithm, effect);\n        }\n    }\n\n    _singleConstructor(target, algorithm, effect) {\n        let uniqID = '_' + Math.random().toString(36).substr(2, 9);\n        this._expression = 'data.' + uniqID;\n        this._policies = {\n            [uniqID]: compilePolicy(target, algorithm, effect)\n        };\n    }\n\n    _mergeConstructor(origin, source, effect) {\n        this._expression = origin._expression + effect + source._expression;\n        this._policies = {};\n        Object.assign(this._policies, origin._policies, source._policies);\n    }\n\n\n    constructor(origin, source, effect) {\n        if ((origin.expression !== undefined) && (origin.policies !== undefined)) {\n            this._groupConstructor(origin);\n        } else if (source === undefined && effect === undefined) {\n            this._singleConstructor(origin.target, origin.algorithm, origin.effect);\n        } else {\n            this._mergeConstructor(origin, source, effect);\n        }\n    }\n\n    check(user, action, env, resource) {\n        let result = {};\n        for (const key in this._policies) {\n            result[key] = this._policies[key](user, action, env, resource);\n        }\n\n        return (new Function('data', 'return ' + this._expression + ';'))(result);\n    }\n\n    and(policy) {\n        return new Policy(this, policy, '&&');\n    }\n\n    or(policy) {\n        return new Policy(this, policy, '||');\n    }\n}\n\n// static methods\nPolicy.compilePolicy = compilePolicy;\nPolicy.compileRule = compileRule;\n\n// service DI\nDI.loadPresets();\n\nexport {\n    Policy,\n    DI,\n    settings\n}\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n\n// WEBPACK FOOTER //\n// (webpack)/buildin/global.js","import String from './string';\nimport Location from './location';\nimport Time from './time';\n\nexport default {\n    String,\n    Location,\n    Time\n}\n\n\n// WEBPACK FOOTER //\n// ./src/DI/index.js","export default {\n    $trim: function(str) {\n        return str.trim();\n    },\n\n    $uppercase: function (str) {\n        return str.toUpperCase();\n    },\n\n    $lowercase: function (str) {\n        return str.toLowerCase();\n    }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/DI/string.js","export default {\n}\n\n\n// WEBPACK FOOTER //\n// ./src/DI/location.js","export default {\n}\n\n\n// WEBPACK FOOTER //\n// ./src/DI/time.js"],"sourceRoot":""}